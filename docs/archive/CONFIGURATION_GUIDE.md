# Configuration Files Documentation

## 📁 File-by-File Configuration Guide

### Shell & Terminal

#### `private_dot_bashrc`
**Purpose**: Main Bash shell configuration  
**Location**: `~/.bashrc`  
**Features**:
- Custom aliases and functions
- PATH environment variables
- Shell options and completion
- Integration with other tools

#### `dot_profile`
**Purpose**: POSIX shell profile loaded by all shells  
**Location**: `~/.profile`  
**Features**:
- Environment variables
- System-wide configurations
- Display and locale settings

#### `dot_vimrc`
**Purpose**: Vim editor configuration  
**Location**: `~/.vimrc`  
**Features**:
- Key mappings and shortcuts
- Plugin configuration
- Syntax highlighting
- Editor behavior settings

### Application Configurations

#### `private_dot_config/kitty/kitty.conf`
**Purpose**: Kitty terminal emulator configuration  
**Location**: `~/.config/kitty/kitty.conf`  
**Features**:
- Font configuration (JetBrains Mono)
- Catppuccin Macchiato theme
- Performance optimizations
- Tab and window management
- Key bindings

**Theme Files**:
- `catppuccin-themes/`: Official Catppuccin variants
- `kitty-themes/`: Extensive theme collection

#### `private_dot_config/nvim/`
**Purpose**: Neovim editor configuration  
**Location**: `~/.config/nvim/`  
**Structure**:
```
nvim/
├── init.lua                 # Main configuration entry
├── lua/
│   ├── core/               # Core Neovim settings
│   │   ├── autocmds.lua   # Auto commands
│   │   ├── keymaps.lua    # Key mappings
│   │   ├── options.lua    # Editor options
│   │   └── lazy_bootstrap.lua  # Plugin manager setup
│   ├── plugins/           # Plugin configurations
│   │   ├── basic.lua      # Essential plugins
│   │   ├── claude_code.lua # Claude AI integration
│   │   ├── colorscheme.lua # Theme configuration
│   │   ├── completion.lua  # Autocompletion
│   │   ├── copilot.lua    # GitHub Copilot
│   │   ├── lsp.lua        # Language Server Protocol
│   │   ├── telescope.lua  # Fuzzy finder
│   │   └── treesitter.lua # Syntax highlighting
│   └── custom/            # User customizations
└── lazy-lock.json         # Plugin version lock
```

**Key Features**:
- LSP support for multiple languages
- Intelligent autocompletion
- Git integration with signs
- File explorer and fuzzy finding
- AI assistance integration

#### `private_dot_config/awesome/`
**Purpose**: AwesomeWM window manager configuration  
**Location**: `~/.config/awesome/`  
**Structure**:
```
awesome/
├── rc.lua                  # Main configuration
├── themes/
│   └── catppuccin-macchiato/
│       └── theme.lua       # Theme definitions
├── lain/                   # Widget library (external)
├── freedesktop/            # Desktop integration (external)
├── install-packages.sh     # Dependency installer
├── packages-needed.md      # Required packages
└── README.md              # Detailed documentation
```

**Key Features**:
- Tiling window management
- Custom status bar with widgets
- Catppuccin Macchiato theme
- Vim-style navigation
- System monitoring widgets

#### `private_dot_config/hypr/`
**Purpose**: Hyprland Wayland compositor configuration  
**Location**: `~/.config/hypr/`  
**Files**:
- `hyprland.conf`: Main configuration
- `hyprland.conf.autogenerated`: Template-generated version
- `catppuccin/`: Catppuccin theme integration

**Key Features**:
- Modern Wayland compositor
- Smooth animations and effects
- Window rules and workspace management
- Blur and transparency effects
- Integration with Waybar

#### `private_dot_config/waybar/`
**Purpose**: Status bar for Wayland (used with Hyprland)  
**Location**: `~/.config/waybar/`  
**Files**:
- `config`: Main configuration (JSON format)
- `style.css`: Styling and themes

**Modules**:
- Clock and calendar
- System resources (CPU, memory)
- Network and Bluetooth
- Audio controls
- Workspace indicators

#### `private_dot_config/rofi/`
**Purpose**: Application launcher and menu system  
**Location**: `~/.config/rofi/`  
**Structure**:
```
rofi/
├── bin/                    # Utility scripts
├── config/                 # Theme configurations
│   ├── launcher.rasi      # Main launcher theme
│   ├── powermenu.rasi     # Power menu theme
│   ├── colors.rasi        # Color definitions
│   └── font.rasi          # Font settings
└── README.md              # Usage documentation
```

#### `private_dot_config/zellij/`
**Purpose**: Terminal multiplexer configuration  
**Location**: `~/.config/zellij/`  
**Files**:
- `config.kdl`: Main configuration in KDL format
- `config.kdl.bak`: Backup configuration

**Features**:
- Modern alternative to tmux/screen
- Rust-based performance
- Built-in session management
- Plugin system support

#### `private_dot_config/ranger/`
**Purpose**: Terminal-based file manager  
**Location**: `~/.config/ranger/`  
**Files**:
- `rc.conf`: Main configuration
- `commands.py`: Custom commands
- `rifle.conf`: File associations
- `scope.sh`: File preview script

#### `private_dot_config/nnn/`
**Purpose**: Lightweight terminal file manager  
**Location**: `~/.config/nnn/`  
**Structure**:
- `bookmarks/`: Quick access locations
- `mounts/`: Mount point management
- `plugins/`: Extension scripts
- `sessions/`: Saved sessions

#### `private_dot_config/neofetch/`
**Purpose**: System information display tool  
**Location**: `~/.config/neofetch/`  
**Files**:
- `config.conf`: Display configuration and styling

### Display & Layout

#### `dot_screenlayout/`
**Purpose**: Display configuration scripts  
**Location**: `~/.screenlayout/`  
**Scripts**:
- `executable_home-desktop.sh`: Home office setup
- `executable_work-desktop.sh`: Work environment setup

**Usage**: Run scripts to apply monitor configurations for different environments.

### Mobile & Remote

#### `dot_termux/`
**Purpose**: Termux Android terminal configuration  
**Location**: `~/.termux/`  
**Files**:
- `font.ttf`: Custom font for mobile terminal
- `private_colors.properties`: Color scheme configuration

### System Configuration

#### `system_nixos/`
**Purpose**: NixOS system-level configuration  
**Location**: Managed separately, deployed to `/etc/nixos/`  
**Files**:
- `configuration.nix`: Main system configuration
- `flake.nix`: Nix flake for reproducible builds
- `flake.lock`: Dependency version lock
- `hardware-configuration.nix`: Hardware-specific settings
- `gemini-cli.nix`: Custom Gemini CLI module

**Key Features**:
- Declarative system configuration
- Reproducible builds
- Package management
- Service configuration
- Hardware optimization

### Utility Scripts

#### `system_scripts/deploy-nixos.sh`
**Purpose**: Automated NixOS deployment with safety features  
**Features**:
- Automatic backup creation
- Configuration validation
- Error handling and rollback
- Safety checks

#### `system_scripts/test-deploy-nixos.sh`
**Purpose**: Test NixOS deployment without applying changes  
**Features**:
- Dry-run deployment
- Configuration validation
- Dependency checking

### AI Integration

#### `dot_claude/CLAUDE.md`
**Purpose**: Global instructions for Claude AI assistant  
**Location**: `~/.claude/CLAUDE.md`  
**Features**:
- Repository structure understanding
- Common commands and workflows
- Safety guidelines
- Best practices for dotfiles management

## 🔧 Configuration Dependencies

### Core Dependencies
- **chezmoi**: Dotfiles management
- **git**: Version control
- **curl**: Download and installation
- **bash**: Shell scripting

### Application Dependencies
- **kitty**: Terminal emulator
- **neovim**: Text editor
- **awesome** / **hyprland**: Window managers
- **rofi**: Application launcher
- **waybar**: Status bar (Wayland)
- **zellij**: Terminal multiplexer

### System Dependencies (NixOS)
- **nix**: Package manager
- **nixos-rebuild**: System management
- **systemd**: Service management

## 🎨 Theming System

All configurations use **Catppuccin Macchiato** as the primary theme:

### Color Palette
- **Base**: `#24273a` (Dark background)
- **Surface**: `#363a4f` (Slightly lighter)
- **Overlay**: `#6e738d` (Muted text)
- **Text**: `#cad3f5` (Primary text)
- **Accent**: `#8bd5ca` (Cyan/teal for highlights)

### Application Theme Files
- Kitty: `catppuccin-themes/macchiato.conf`
- Neovim: Catppuccin plugin configuration
- AwesomeWM: `themes/catppuccin-macchiato/theme.lua`
- Hyprland: `catppuccin/themes/macchiato.conf`
- Rofi: `config/colors.rasi`

## 🔄 Update Procedures

### Manual Updates
1. **Edit source files**: Use `chezmoi edit <file>`
2. **Test changes**: Run `chezmoi apply --dry-run`
3. **Apply changes**: Run `chezmoi apply`
4. **Commit changes**: Git workflow in chezmoi source

### Automated Updates
- Documentation automatically updated by Claude
- Theme consistency maintained across applications
- Dependencies tracked and validated

### Safety Measures
- Automatic backups before system changes
- Configuration validation before deployment
- Rollback capabilities for failed updates
- Version control for all changes

## 🚀 Deployment Lessons Learned

### NixOS Deployment Best Practices

#### Machine-Specific vs Shared Configuration

**Key Learning**: Hardware configuration should never be managed by chezmoi as it's system-specific.

**Implementation**:
- `hardware-configuration.nix` stays in `/etc/nixos/` on each machine
- Machine configurations import `./hardware-configuration.nix` (relative to `/etc/nixos/`)
- Deployment script excludes `hardware-configuration.nix` from copying

**Why This Matters**:
- Different machines have different hardware (disk UUIDs, filesystems, CPU types)
- Copying hardware config from one machine to another causes boot failures
- Each machine should generate its own with `nixos-generate-config`

#### Relative Path Consistency

**Key Learning**: All paths in machine configurations must be relative to `/etc/nixos/`, not to the chezmoi directory structure.

**Before** (Incorrect):
```nix
# In machines/work_modular.nix
gemini-cli = pkgs.callPackage ../gemini-cli.nix {};  # Wrong: relative to machines/
imports = [ ../hardware-configuration.nix ];          # Wrong: tries to go up from machines/
```

**After** (Correct):
```nix
# In machines/work_modular.nix (when copied to /etc/nixos/configuration.nix)
gemini-cli = pkgs.callPackage ./gemini-cli.nix {};    # Correct: relative to /etc/nixos/
imports = [ ./hardware-configuration.nix ];           # Correct: looks in /etc/nixos/
```

**Why This Matters**: The deployment script copies machine configs to `/etc/nixos/configuration.nix`, so paths must work from that location.

#### Package Build Failures & Channel Management

**Key Learning**: nixos-unstable can have broken packages; be prepared to disable problematic packages or switch channels.

**Common Issues Encountered**:
- `redshift`: autotools compatibility issues
- `gimp`: similar autotools problems  
- `claude-desktop`: hash mismatches from upstream changes
- `gemini-cli`: outdated package hashes

**Mitigation Strategies**:
1. **Temporarily disable packages**: Comment out broken packages to get system building
2. **Use nixos-stable**: Switch to stable channel for more reliable builds
3. **Pin specific package versions**: Use specific commits/versions for critical packages
4. **Monitor upstream**: Track package status and re-enable when fixed

**Example Package Disabling**:
```nix
environment.systemPackages = with pkgs; [
  # redshift     # Temporarily disabled due to build issues - 2025-07-15
  # gimp         # Autotools issues in unstable - 2025-07-15
  firefox        # This one works fine
];
```

#### Flake Lock File Management

**Key Learning**: `flake.lock` files are machine/environment specific and should be regenerated on new systems.

**Problem**: Copying `flake.lock` from one machine to another can cause hash mismatches.

**Solution**: Always regenerate flake locks on new deployments:
```bash
rm flake.lock
nix flake lock
```

**Best Practice**: Consider not tracking `flake.lock` in chezmoi for system configs, or add regeneration to deployment script.

#### Error Debugging Strategy

**Key Learning**: NixOS errors can be cryptic; follow systematic debugging approach.

**Debugging Steps**:
1. **Check for absolute paths**: Look for `/nix/store/` references in error messages
2. **Verify relative paths**: Ensure imports work from deployment location (`/etc/nixos/`)
3. **Test incremental builds**: Comment out packages one by one to isolate issues
4. **Check channel status**: Sometimes switching to stable resolves widespread build issues
5. **Update flake inputs**: Hash mismatches often need `nix flake update`

#### Deployment Script Improvements

**Key Learning**: The deployment script should be more resilient and informative.

**Implemented Improvements**:
- Exclude `hardware-configuration.nix` from copying
- Better error handling and rollback mechanisms
- Clear feedback about what's being copied and why

**Future Improvements to Consider**:
- Automatic flake.lock regeneration option
- Package build validation before full deployment
- Better machine detection/configuration selection
- Integration with chezmoi apply workflow

### Recommended Deployment Workflow

1. **Fresh System Setup**:
   ```bash
   # Generate hardware config (once per machine)
   sudo nixos-generate-config
   
   # Deploy chezmoi config
   ./system_scripts/deploy-nixos.sh
   
   # If build fails, regenerate flake.lock
   cd system_nixos && rm flake.lock && nix flake lock
   ```

2. **Troubleshooting Build Failures**:
   ```bash
   # Test build without applying
   sudo nixos-rebuild dry-build --flake /etc/nixos
   
   # If specific packages fail, temporarily disable them
   # Edit /etc/nixos/configuration.nix to comment out problematic packages
   
   # Try stable channel if unstable has widespread issues
   # Edit flake.nix: nixpkgs.url = "github:NixOS/nixpkgs/nixos-24.11"
   ```

3. **Successful Deployment**:
   ```bash
   sudo nixos-rebuild switch --flake /etc/nixos
   ```

---

This guide covers all major configuration files and their purposes. Each application has its own detailed configuration that can be customized while maintaining the overall theme and functionality consistency.