# ranger Configuration - Optimized for Power Users
# Enhanced file manager with rich features and extensive customization

# ===================================================================
# == Core Settings
# ===================================================================

# View mode - Miller columns for hierarchical navigation
set viewmode miller
set column_ratios 1,3,4

# File filtering and visibility
set hidden_filter ^\.|\.(?:pyc|pyo|bak|swp|tmp|cache)$|^lost\+found$|^__(py)?cache__$
set show_hidden false

# Preview configuration
set preview_script ~/.config/ranger/scope.sh
set use_preview_script true
set preview_files true
set preview_directories true
set collapse_preview true
set preview_images true
set preview_images_method kitty
set w3m_delay 0.02

# File operations
set confirm_on_delete multiple
set automatically_count_files true
set open_all_images true

# Version control integration
set vcs_aware true
set vcs_backend_git enabled
set vcs_backend_hg disabled
set vcs_backend_bzr disabled
set vcs_backend_svn disabled
set vcs_msg_length 50

# Interface appearance
set draw_borders both
set mouse_enabled true
set display_size_in_main_column true
set display_size_in_status_bar true
set display_free_space_in_status_bar true
set display_tags_in_all_columns true
set draw_progress_bar_in_status_bar true

# Performance optimizations
set flushinput true
set scroll_offset 8
set save_console_history true

# History and bookmarks
set max_history_size 50
set max_console_history_size 100
set autosave_bookmarks true
set save_backtick_bookmark true
set show_hidden_bookmarks true

# Theme and appearance
set colorscheme solarized
set unicode_ellipsis true

# Terminal integration
set update_tmux_title true
set shorten_title 3
set hostname_in_titlebar true
set tilde_in_titlebar true

# ===================================================================
# == Command Aliases
# ===================================================================

alias e edit
alias q quit
alias q! quit!
alias qa quitall
alias qa! quitall!
alias qall quitall
alias qall! quitall!
alias setl setlocal

alias filter scout -prts
alias find scout -aets
alias mark scout -mr
alias unmark scout -Mr
alias search scout -rs
alias search_inc scout -rts
alias travel scout -aefklst

# ===================================================================
# == Custom Keybindings
# ===================================================================

# Enhanced navigation
map j move down=1
map k move up=1
map h move left=1
map l move right=1
map gg move to=0
map G move to=-1

# Fast movement
map J move down=5
map K move up=5
map <C-d> move down=0.5 pages=True
map <C-u> move up=0.5 pages=True

# File selection
map <Space> mark_files toggle=True
map v mark_files all=True toggle=True
map V toggle_visual_mode
map uv mark_files all=True val=False
map uV toggle_visual_mode reverse=True

# File operations
map yy copy
map uy uncut
map ya copy mode=add
map yr copy mode=remove
map yt copy mode=toggle

map dd cut
map ud uncut
map da cut mode=add
map dr cut mode=remove
map dt cut mode=toggle

map pp paste
map po paste overwrite=True
map pP paste append=True
map pO paste overwrite=True append=True
map pl paste_symlink relative=False
map pL paste_symlink relative=True

# File management
map dD delete
map cw console rename%space
map a rename_append
map A eval fm.open_console('rename ' + fm.thisfile.relative_path.replace("%", "%%"))
map I eval fm.open_console('rename ' + fm.thisfile.relative_path.replace("%", "%%"), position=7)

# Quick bookmarks
map gh cd ~
map gd cd ~/Downloads
map gp cd ~/Projects
map gD cd ~/Documents
map gP cd ~/Pictures
map gV cd ~/Videos
map gc cd ~/.config
map gs cd ~/.local/share/chezmoi
map gn cd ~/system_nixos
map gw cd /etc/nixos
map gA cd ~/AndroidStudioProjects
map gt cd /tmp
map gr cd /
map ge cd /etc
map gu cd /usr
map gv cd /var
map gm cd /media
map gM cd /mnt

# Archive operations
map ex extract
map zi console shell zip -r %f.zip %s
map zt console shell tar czf %f.tar.gz %s
map z7 console shell 7z a %f.7z %s

# External programs
map E edit
map o open_with
map O console open_with%space
map r chain draw_possible_programs; console open_with%%space

# Search and filter
map / console search%space
map n search_next
map N search_next forward=False
map ff console scout -aefts%space
map fd console scout -aets%space

# FZF integration (requires custom commands)
map <C-f> fzf_select
map <C-g> fzf_locate

# Shell access
map ! console shell%space
map @ console -p6 shell  %%s
map # console shell -p%space
map s console shell%space
map S shell $SHELL

# Tab management
map <C-n> tab_new
map <C-w> tab_close
map <TAB> tab_move 1
map <S-TAB> tab_move -1
map gt tab_move 1
map gT tab_move -1
map gn tab_new
map gc tab_close
map uq tab_restore

# Toggle settings
map zh set show_hidden!
map zp set preview_files!
map zP set preview_directories!
map zi set preview_images!
map zv set use_preview_script!
map zc set collapse_preview!
map zd set sort_directories_first!
map zI set flushinput!
map zm set mouse_enabled!
map zf console filter%space

# Sorting
map or set sort_reverse!
map oz set sort=random
map os chain set sort=size; set sort_reverse=False
map ob chain set sort=basename; set sort_reverse=False
map on chain set sort=natural; set sort_reverse=False
map om chain set sort=mtime; set sort_reverse=False
map oc chain set sort=ctime; set sort_reverse=False
map oa chain set sort=atime; set sort_reverse=False
map ot chain set sort=type; set sort_reverse=False
map oe chain set sort=extension; set sort_reverse=False

# Reverse sorting
map oS chain set sort=size; set sort_reverse=True
map oB chain set sort=basename; set sort_reverse=True
map oN chain set sort=natural; set sort_reverse=True
map oM chain set sort=mtime; set sort_reverse=True
map oC chain set sort=ctime; set sort_reverse=True
map oA chain set sort=atime; set sort_reverse=True
map oT chain set sort=type; set sort_reverse=True
map oE chain set sort=extension; set sort_reverse=True

# File info and operations
map i display_file
map ? help
map W display_log
map w taskview_open
map du shell -p du --max-depth=1 -h --apparent-size
map dU shell -p du --max-depth=1 -h --apparent-size | sort -rh

# Copy paths
map yp yank path
map yd yank dir
map yn yank name
map y. yank name_without_extension

# Tagging
map t tag_toggle
map ut tag_remove
map "<any> tag_toggle tag=%any

# Permissions
map = chmod

# Quick file creation
map tf console touch%space
map md console mkdir%space

# Image operations
map bg shell feh --bg-scale %f &
map iv shell feh %f &

# Git operations (requires custom commands)
map gb git_branch
map gl git_log  
map gs git_status
map gf git_diff

# ===================================================================
# == Function Keys (Midnight Commander style)
# ===================================================================

map <F1> help
map <F2> rename_append
map <F3> display_file
map <F4> edit
map <F5> copy
map <F6> cut
map <F7> console mkdir%space
map <F8> console delete
map <F10> exit

# ===================================================================
# == Console Keybindings
# ===================================================================

# Basic console navigation
cmap <tab> eval fm.ui.console.tab()
cmap <s-tab> eval fm.ui.console.tab(-1)
cmap <ESC> eval fm.ui.console.close()
cmap <CR> eval fm.ui.console.execute()
cmap <C-l> redraw_window

# History navigation
cmap <up> eval fm.ui.console.history_move(-1)
cmap <down> eval fm.ui.console.history_move(1)

# Line editing
cmap <C-a> eval fm.ui.console.move(right=-1, absolute=True)
cmap <C-e> eval fm.ui.console.move(right=1, absolute=True)
cmap <C-k> eval fm.ui.console.delete_rest(1)
cmap <C-u> eval fm.ui.console.delete_rest(-1)
cmap <C-w> eval fm.ui.console.delete_word()
cmap <C-y> eval fm.ui.console.paste()

# ===================================================================
# == Pager Keybindings
# ===================================================================

# Movement in pager
pmap j pager_move down=1
pmap k pager_move up=1
pmap h pager_move left=4
pmap l pager_move right=4
pmap gg pager_move to=0
pmap G pager_move to=-1
pmap <C-d> pager_move down=0.5 pages=True
pmap <C-u> pager_move up=0.5 pages=True
pmap <Space> pager_move down=1.0 pages=True
pmap <C-b> pager_move up=1.0 pages=True

# Pager actions
pmap <ESC> pager_close
pmap q pager_close
pmap E edit_file

# ===================================================================
# == Custom Commands (require commands.py)
# ===================================================================

# Note: These commands require implementation in ~/.config/ranger/commands.py

# FZF integration
# map <C-f> fzf_select
# map <C-g> fzf_locate

# Git operations
# map gb git_branch
# map gl git_log
# map gs git_status
# map gf git_diff

# Archive extraction
# map ex extract

# Background image setting
# map bg set_background

# Bulk rename
# map br bulk_rename

# Trash operations (safer than delete)
# map tt trash
# map tr trash_restore

# Quick preview
# map pv toggle_preview

# Directory bookmarks
# map bs bookmark_save
# map bl bookmark_load

# File operations
# map cf create_file
# map cd create_dir

# Search enhancements
# map fs fzf_search
# map rg ripgrep_search

# ===================================================================
# == Line Modes
# ===================================================================

# Change line mode display
map Mf linemode filename
map Mi linemode fileinfo  
map Mm linemode mtime
map Mp linemode permissions
map Ms linemode sizemtime
map Mt linemode metatitle
map Md linemode devicons

# Default line mode
default_linemode devicons